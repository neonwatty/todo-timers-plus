<% content_for :page_title, "New Timer" %>
<% content_for :page_description, "Create a new timer to track your time" %>

<div class="bg-white rounded-xl shadow-sm border border-gray-100 p-8 max-w-2xl mx-auto">
  <%= form_with model: @timer, local: true, class: "space-y-6" do |form| %>
    <% if @timer.errors.any? %>
      <div class="rounded-md bg-red-50 p-4">
        <div class="text-sm text-red-700">
          <ul class="list-disc list-inside space-y-1">
            <% @timer.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      </div>
    <% end %>

    <div class="form-group">
      <%= form.label :task_name, class: "form-label" do %>
        Task Name
        <span class="text-red-500">*</span>
      <% end %>
      <%= form.text_field :task_name, 
          class: "form-input",
          placeholder: "e.g., Work on project proposal",
          required: true %>
      <p class="text-sm text-gray-500">
        Give your timer a descriptive name so you can track what you worked on.
      </p>
    </div>

    <div class="form-group">
      <label class="form-label">Timer Type</label>
      <div class="grid grid-cols-2 gap-4">
        <label class="relative flex cursor-pointer rounded-lg border border-gray-300 bg-white p-4 shadow-sm focus:outline-none hover:border-blue-500 transition-colors">
          <%= form.radio_button :timer_type, "stopwatch", class: "sr-only", checked: true, onclick: "document.getElementById('duration-picker').classList.add('hidden')" %>
          <div class="flex flex-1">
            <div class="flex flex-col">
              <span class="block text-sm font-medium text-gray-900">
                <%= icon :clock, size: 5, class: "text-gray-600 mb-1" %>
                Stopwatch
              </span>
              <span class="mt-1 flex items-center text-xs text-gray-500">
                Count up from zero
              </span>
            </div>
          </div>
        </label>
        
        <label class="relative flex cursor-pointer rounded-lg border border-gray-300 bg-white p-4 shadow-sm focus:outline-none hover:border-blue-500 transition-colors">
          <%= form.radio_button :timer_type, "countdown", class: "sr-only", onclick: "document.getElementById('duration-picker').classList.remove('hidden')" %>
          <div class="flex flex-1">
            <div class="flex flex-col">
              <span class="block text-sm font-medium text-gray-900">
                <%= icon :hourglass, size: 5, class: "text-gray-600 mb-1" %>
                Countdown
              </span>
              <span class="mt-1 flex items-center text-xs text-gray-500">
                Count down from set time
              </span>
            </div>
          </div>
        </label>
      </div>
    </div>

    <div id="duration-picker" class="form-group hidden">
      <label class="form-label">Duration</label>
      <div class="flex items-center space-x-2">
        <div class="flex-1">
          <%= number_field_tag "timer[duration_hours]", 0, 
              class: "form-input text-center", 
              min: 0, 
              max: 99,
              placeholder: "HH" %>
          <p class="text-xs text-gray-500 text-center mt-1">Hours</p>
        </div>
        <span class="text-xl font-semibold text-gray-500">:</span>
        <div class="flex-1">
          <%= number_field_tag "timer[duration_minutes]", 25, 
              class: "form-input text-center", 
              min: 0, 
              max: 59,
              placeholder: "MM" %>
          <p class="text-xs text-gray-500 text-center mt-1">Minutes</p>
        </div>
        <span class="text-xl font-semibold text-gray-500">:</span>
        <div class="flex-1">
          <%= number_field_tag "timer[duration_seconds]", 0, 
              class: "form-input text-center", 
              min: 0, 
              max: 59,
              placeholder: "SS" %>
          <p class="text-xs text-gray-500 text-center mt-1">Seconds</p>
        </div>
      </div>
      
      <div class="mt-3 flex flex-wrap gap-2">
        <button type="button" onclick="setDuration(5)" class="px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">5 min</button>
        <button type="button" onclick="setDuration(10)" class="px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">10 min</button>
        <button type="button" onclick="setDuration(15)" class="px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">15 min</button>
        <button type="button" onclick="setDuration(25)" class="px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">25 min</button>
        <button type="button" onclick="setDuration(30)" class="px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">30 min</button>
        <button type="button" onclick="setDuration(45)" class="px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">45 min</button>
        <button type="button" onclick="setDuration(60)" class="px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">1 hour</button>
      </div>
    </div>

    <div class="form-group">
      <%= form.label :tags, class: "form-label" do %>
        Tags
        <span class="text-gray-400 font-normal">(Optional)</span>
      <% end %>
      <%= form.text_field :tags, 
          class: "form-input",
          placeholder: "e.g., work, project, client-abc" %>
      <p class="text-sm text-gray-500">
        Separate multiple tags with commas. Use tags to categorize and filter your timers.
      </p>
    </div>

    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-5 border border-blue-200">
      <h3 class="text-sm font-semibold text-blue-900 mb-3 flex items-center">
        <%= icon :lightning, size: 4, class: "text-blue-600 mr-2" %>
        Getting Started
      </h3>
      <ul class="text-sm text-blue-800 space-y-2">
        <li class="flex items-start">
          <span class="text-blue-600 mr-2">•</span>
          <span>Create your timer with a descriptive task name</span>
        </li>
        <li class="flex items-start">
          <span class="text-blue-600 mr-2">•</span>
          <span>Once created, you can start, pause, and stop the timer</span>
        </li>
        <li class="flex items-start">
          <span class="text-blue-600 mr-2">•</span>
          <span>Use tags to organize related tasks together</span>
        </li>
        <li class="flex items-start">
          <span class="text-blue-600 mr-2">•</span>
          <span>Track your productivity in the dashboard</span>
        </li>
      </ul>
    </div>

    <div class="flex flex-col sm:flex-row gap-3 pt-2">
      <%= form.submit "Create Timer", class: "btn-primary btn-lg" %>
      <%= link_to timers_path, class: "btn-secondary btn-lg" do %>
        Cancel
      <% end %>
    </div>
  <% end %>
</div>

<script>
  function setDuration(minutes) {
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    
    document.querySelector('input[name="timer[duration_hours]"]').value = hours;
    document.querySelector('input[name="timer[duration_minutes]"]').value = mins;
    document.querySelector('input[name="timer[duration_seconds]"]').value = 0;
  }
  
  // Make radio buttons visually active
  document.querySelectorAll('input[name="timer[timer_type]"]').forEach(radio => {
    radio.addEventListener('change', function() {
      // Remove active styling from all
      document.querySelectorAll('label.relative').forEach(label => {
        label.classList.remove('border-blue-500', 'ring-2', 'ring-blue-500');
      });
      // Add active styling to selected
      if (this.checked) {
        this.closest('label').classList.add('border-blue-500', 'ring-2', 'ring-blue-500');
      }
    });
  });
  
  // Initialize the first radio button as selected
  document.querySelector('input[name="timer[timer_type]"]:checked')?.closest('label').classList.add('border-blue-500', 'ring-2', 'ring-blue-500');
</script>
